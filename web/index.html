<html>

<head>
	<link rel="stylesheet" type="text/css" href="boxscore.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
	<script src="pie.js"></script>
	<script src="boxscore.js"></script>
	<script src="playbyplay.js"></script>

	<script>
		var gameID = "0041400406";
		//var gameID = "0021400962";
		var homeTeam = {};
		var awayTeam = {};
		$.ajax({
		    type : 'POST',
		    url : 'http://eaganr.com:3000',           
		    data: {
					//gameID : "0021400962",
					func: "getBoxScore",
					gameID : gameID
					//gameID : "0011400053"
				},
		    success:function (data) {
					console.log(data);
				
					homeTeam.id=data.gameSummary[0].homeTeamId;
					homeTeam.abbrev=data.teamStats[1].teamAbbreviation;
					homeTeam.score=data.teamStats[1].pTS;
					awayTeam.id=data.gameSummary[0].visitorTeamId;
					awayTeam.abbrev=data.teamStats[0].teamAbbreviation;
					awayTeam.score=data.teamStats[0].pTS;

					document.getElementById("hometeam").getElementsByTagName("h1")[0].innerHTML=homeTeam.abbrev+" - "+homeTeam.score;
					document.getElementById("awayteam").getElementsByTagName("h1")[0].innerHTML=awayTeam.score+" - "+awayTeam.abbrev;

					homeTeam.players = [];
					awayTeam.players = [];
					for(var i=0;i<data.playerStats.length;i++) {
						var player = data.playerStats[i];
						if(player.teamId === homeTeam.id) {
							homeTeam.players.push(player);
						}
						if(player.teamId === awayTeam.id) {
							awayTeam.players.push(player);
						}
					}
					console.log(homeTeam.players);
					console.log(awayTeam.players);

					homeTeam.scoring = new pie("#homescoring")
						.w(250).h(250)
						.value("pTS")
						.data(homeTeam.players)
						.diff("playerName")
						.label(function(d) { return d.data["playerName"].split(" ")[1]+" - "+d.data["pTS"];})
						.title(homeTeam.abbrev + " Scoring")
						.draw();	

					awayTeam.scoring = new pie("#awayscoring")
						.w(250).h(250)
						.value("pTS")
						.data(awayTeam.players)
						.diff("playerName")
						.label(function(d) { return d.data["playerName"].split(" ")[1]+" - "+d.data["pTS"];})
						.title(awayTeam.abbrev + " Scoring")
						.draw();

					//boxscore
					homeTeam.box = new boxscore("homebox",homeTeam.players);
					awayTeam.box = new boxscore("awaybox",awayTeam.players);

					var homeRebs = [
						{abbrev:data.teamStats[1].teamAbbreviation, reb:data.teamStats[1].dREB},
						{abbrev:data.teamStats[0].teamAbbreviation, reb:data.teamStats[0].oREB}
					];
					var awayRebs = [
						{abbrev:data.teamStats[0].teamAbbreviation, reb:data.teamStats[0].dREB},
						{abbrev:data.teamStats[1].teamAbbreviation, reb:data.teamStats[1].oREB}
					];

					homeTeam.rebounds = new pie("#homerebounding")
						.w(250).h(250)
						.value("reb")
						.data(homeRebs)
						.diff("abbrev")
						.label(function(d) { return d.data.abbrev+" - "+d.data.reb;})
						.title(homeTeam.abbrev + " Basket Rebounds")
						.draw();

					awayTeam.rebounds = new pie("#awayrebounding")
						.w(250).h(250)
						.value("reb")
						.data(awayRebs)
						.diff("abbrev")
						.label(function(d) { return d.data.abbrev+" - "+d.data.reb;})
						.title(awayTeam.abbrev + " Basket Rebounds")
						.draw();

				}
		  });


		var pbp = new playbyplay();
		$.ajax({
		    type : 'POST',
		    url : 'http://eaganr.com:3000',           
		    data: {
					func: "getPlayByPlay",
					gameID : gameID
				},
		    success:function (data) {
					var homeplayers = homeTeam.players.map(function(d) { return d.playerName.split(" ")[d.playerName.split(" ").length -1]; });
					var awayplayers = awayTeam.players.map(function(d) { return d.playerName.split(" ")[d.playerName.split(" ").length -1]; });

					pbp.homeplayers(homeplayers)
						.awayplayers(awayplayers)
						.selector("#chart")
						.data(data.playByPlay)
						.parse()
						.draw();


			}
		});
	</script>


</head>

<body>
	<div class="content">	
		<div class="team" id="hometeam">
			<h1></h1>
			<div class="charts">
				<div class="pie" id="homescoring"></div>
				<div class="pie" id="homerebounding"></div>
			</div>
			<div class="boxscore" id="homebox"></div>
		</div>
		<div class="team" id="awayteam">
			<h1></h1>
			<div class="charts">
				<div class="pie" id="awayscoring"></div>
				<div class="pie" id="awayrebounding"></div>
			</div>
			<div class="boxscore" id="awaybox"></div>
		</div>
		<br />
		<br />
		<svg id="chart" width="1000" height="500"></svg>
		<div class="playbyplay" id="pbp"></div>
	</div>
</body>

</html
